# Knowledge Engine API æ–‡æ¡£

## ğŸ“˜ æœåŠ¡æ¦‚è¿°

Knowledge Engine æ˜¯ä¸€ä¸ªåŸºäº LightRAG çš„çŸ¥è¯†å›¾è°±æ„å»ºå’Œé—®ç­”æœåŠ¡ï¼Œæä¾›çŸ¥è¯†å›¾è°±å¯è§†åŒ–å’Œæ™ºèƒ½é—®ç­”åŠŸèƒ½ã€‚

**Base URL**: `http://localhost:8002`
---

## .envå­—æ®µ 
éœ€è¦åœ¨`.env`ä¸­å¡«å…¥ä»¥ä¸‹å­—æ®µï¼š
```
LLM_API_KEY=sk-your-deepseek-key-here
LLM_BASE_URL=https://api.deepseek.com
LLM_MODEL=deepseek-chat
KNOWLEDGE_ENGINE_URL=http://localhost:8002
```
---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¥å£

### 1. è·å–çŸ¥è¯†å›¾è°± â­

**ã€å‰ç«¯ä¸»è¦ä½¿ç”¨ã€‘** è·å–æŒ‡å®šæ¦‚å¿µçš„å®Œæ•´çŸ¥è¯†å›¾è°±æ•°æ®ï¼Œç”¨äºå¯è§†åŒ–å±•ç¤ºã€‚

#### è¯·æ±‚

```http
GET /api/graph/{concept}
```

#### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| concept | string | âœ… | çŸ¥è¯†å›¾è°±çš„æ ¸å¿ƒæ¦‚å¿µï¼ˆå¦‚ "ç†µ"ã€"é‡å­çº ç¼ "ï¼‰ |

#### å“åº”ç¤ºä¾‹

```json
{
  "concept": "ç†µ",
  "nodes": [
    {
      "id": "ç†µ",
      "label": "ç†µ",
      "description": "ç³»ç»Ÿæ— åºç¨‹åº¦çš„åº¦é‡ï¼Œæ˜¯çƒ­åŠ›å­¦å’Œä¿¡æ¯è®ºçš„æ ¸å¿ƒæ¦‚å¿µ",
      "domains": ["ç‰©ç†å­¦", "ä¿¡æ¯è®º"],
      "source_chunks": ["chunk-abc123", "chunk-def456"],
      "size": 35
    },
    {
      "id": "çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹",
      "label": "çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹",
      "description": "å­¤ç«‹ç³»ç»Ÿçš„ç†µæ°¸ä¸å‡å°‘",
      "domains": ["ç‰©ç†å­¦"],
      "source_chunks": ["chunk-ghi789"],
      "size": 28
    },
    {
      "id": "ä¿¡æ¯ç†µ",
      "label": "ä¿¡æ¯ç†µ",
      "description": "é¦™å†œæå‡ºçš„è¡¡é‡ä¿¡æ¯ä¸ç¡®å®šæ€§çš„åº¦é‡",
      "domains": ["ä¿¡æ¯è®º", "è®¡ç®—æœºç§‘å­¦"],
      "source_chunks": ["chunk-jkl012"],
    }
  ],
  "edges": [
    {
      "source": "ç†µ",
      "target": "çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹",
      "relation": "éµå¾ª",
      "description": "ç†µå¢åŸç†æ˜¯çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹çš„æ ¸å¿ƒè¡¨è¿°",
    },
    {
      "source": "ç†µ",
      "target": "ä¿¡æ¯ç†µ",
      "relation": "æ‰©å±•ä¸º",
      "description": "é¦™å†œå°†ç‰©ç†ç†µçš„æ¦‚å¿µæ‰©å±•åˆ°ä¿¡æ¯è®ºé¢†åŸŸ",
    }
  ],
  "total_nodes": 15,
  "total_edges": 23
}
```

#### å“åº”å­—æ®µè¯´æ˜

**Graph (æ ¹å¯¹è±¡)**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| concept | string | æ ¸å¿ƒæ¦‚å¿µåç§° |
| nodes | array | èŠ‚ç‚¹åˆ—è¡¨ |
| edges | array | è¾¹åˆ—è¡¨ |
| total_nodes | int | èŠ‚ç‚¹æ€»æ•° |
| total_edges | int | è¾¹æ€»æ•° |

**Node (èŠ‚ç‚¹å¯¹è±¡)**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | string | èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå®ä½“åç§°ï¼‰ |
| label | string | æ˜¾ç¤ºåç§° |
| description | string | å®ä½“æè¿° |
| domains | array[string] | æ‰€å±é¢†åŸŸï¼ˆå¦‚ ["ç‰©ç†å­¦", "ä¿¡æ¯è®º"]ï¼‰ |
| source_chunks | array[string] | æ¥æºæ–‡æ¡£å— ID |
| size | int | èŠ‚ç‚¹å¤§å°ï¼ˆä¾›å‚è€ƒï¼Œå€¼ä¸ºç»“ç‚¹åº¦æ•°+1ï¼‰ |

**Edge (è¾¹å¯¹è±¡)**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| source | string | èµ·å§‹èŠ‚ç‚¹ ID |
| target | string | ç›®æ ‡èŠ‚ç‚¹ ID |
| relation | string | å…³ç³»ç±»å‹ï¼Œä¿ç•™å­—æ®µï¼Œé»˜è®¤`related` |
| description | string | å…³ç³»æè¿°ï¼Œç”¨äºä»‹ç»ä¸¤èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³» | 


#### é”™è¯¯å“åº”

**404 Not Found** - å›¾è°±ä¸å­˜åœ¨

```json
{
  "detail": "Graph for concept 'é‡å­çº ç¼ ' not found"
}
```

---

### 2. çŸ¥è¯†é—®ç­” â­

**ã€å‰ç«¯ä¸»è¦ä½¿ç”¨ã€‘** åˆ©ç”¨ LightRAG æ¨ç†ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œæ”¯æŒè‡ªå®šä¹‰é—®é¢˜ã€‚

#### è¯·æ±‚

```http
POST /api/qa
```

#### è¯·æ±‚ä½“

```json
{
  "concept": "ç†µ",
  "source_node": "ç†µ",
  "target_node": "ä¿¡æ¯ç†µ",
  "question": "å®ƒä»¬åœ¨ç‰©ç†å­¦å’Œä¿¡æ¯è®ºä¸­çš„åº”ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"
}
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| concept | string | âœ… | çŸ¥è¯†å›¾è°±çš„æ ¸å¿ƒæ¦‚å¿µ |
| source_node | string | âœ… | èµ·å§‹èŠ‚ç‚¹ IDï¼ˆå®ä½“åç§°ï¼‰ |
| target_node | string | âœ… | ç›®æ ‡èŠ‚ç‚¹ IDï¼ˆå®ä½“åç§°ï¼‰ |
| question | string | âŒ | è‡ªå®šä¹‰é—®é¢˜ï¼ˆå¯é€‰ï¼Œä¸æä¾›åˆ™ä½¿ç”¨é»˜è®¤é—®é¢˜ï¼‰ |

#### å“åº”ç¤ºä¾‹

answerä¸­çš„å†…å®¹ä¸ºmarkdownæ ¼å¼.

```json
{
  "concept": "ç†µ",
  "source_node": "ç†µ",
  "target_node": "å­¤ç«‹ç³»ç»Ÿ",
  "question": "è¯·è¯¦ç»†è¯´æ˜ 'ç†µ' å’Œ 'å­¤ç«‹ç³»ç»Ÿ' ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æä¾›æ¨ç†è¿‡ç¨‹ï¼Œ100å­—å·¦å³ã€‚",
  "answer": "åœ¨çƒ­åŠ›å­¦ä¸­ï¼Œâ€œç†µâ€ä¸â€œå­¤ç«‹ç³»ç»Ÿâ€ä¹‹é—´çš„å…³ç³»ç”±**çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹**å’Œ**ç†µå¢åŠ åŸç†**æ‰€ç•Œå®šã€‚\n\n**æ ¸å¿ƒå…³ç³»**ï¼šå¯¹äºä¸€ä¸ª**å­¤ç«‹ç³»ç»Ÿ**ï¼ˆä¸å¤–ç•Œæ— ç‰©è´¨å’Œèƒ½é‡äº¤æ¢ï¼‰ï¼Œå…¶å†…éƒ¨å‘ç”Ÿçš„ä»»ä½•**ä¸å¯é€†è¿‡ç¨‹**éƒ½ä¼šå¯¼è‡´ç³»ç»Ÿçš„**ç†µ**å¢åŠ ã€‚åªæœ‰å½“ç³»ç»Ÿç»å†å¯é€†è¿‡ç¨‹æ—¶ï¼Œç†µæ‰ä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œå­¤ç«‹ç³»ç»Ÿçš„ç†µæ°¸è¿œä¸ä¼šè‡ªå‘å‡å°‘ï¼Œè¿™æ˜¯åˆ¤æ–­è¿‡ç¨‹è‡ªå‘æ–¹å‘çš„å…³é”®ä¾æ®ã€‚\n\n**æ¨ç†è¿‡ç¨‹**ï¼šç†µæ˜¯æè¿°ç³»ç»Ÿæ— åºåº¦çš„æ€å‡½æ•°ã€‚æ ¹æ®ç†µå¢åŠ åŸç†ï¼ˆçƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹çš„ä¸€ç§è¡¨è¿°ï¼‰ï¼Œåœ¨å­¤ç«‹ç³»ç»Ÿä¸­ï¼Œç”±äºæ²¡æœ‰å¤–éƒ¨èƒ½é‡è¾“å…¥æ¥ç»´æŒæˆ–å»ºç«‹ç§©åºï¼Œç³»ç»Ÿå†…éƒ¨çš„è‡ªå‘è¿‡ç¨‹ï¼ˆå¦‚æ‰©æ•£ã€çƒ­ä¼ å¯¼ï¼‰æ€»æ˜¯æœç€å¾®è§‚çŠ¶æ€æ•°æ›´å¤šã€æ›´æ— åºçš„æ–¹å‘è¿›è¡Œï¼Œè¿™ç›´æ¥è¡¨ç°ä¸ºç³»ç»Ÿæ€»ç†µçš„å¢åŠ ã€‚ç³»ç»Ÿæœ€ç»ˆä¼šè¾¾åˆ°ç†µæœ€å¤§çš„å¹³è¡¡æ€ã€‚\n\n### å‚è€ƒæ–‡çŒ®\n\n* [1] ç†µæ–¹ç¨‹ä¸å­¤ç«‹ç³»ç»Ÿç†µå¢åŸç†PPTè¯¾ä»¶\n* [2] ç†µçš„å®šä¹‰è¯¦ç»†è§£é‡Šç†µçš„å®šä¹‰ï¼Œä»¥åŠä»–åœ¨çƒ­åŠ›å­¦å’Œä¿¡æ¯å­¦çš„è§£é‡Šè§’åº¦çš„ä¸åŒ...\n* [3] ç†µå¢ï¼šç‰©ç†å­¸ç¬¬å£¹å®šå¾‹"
}
```

#### é»˜è®¤é—®é¢˜è¡Œä¸º

å¦‚æœä¸æä¾› `question` å‚æ•°ï¼Œç³»ç»Ÿä¼šç”Ÿæˆé»˜è®¤é—®é¢˜ï¼š

```json
{
  "concept": "ç†µ",
  "source_node": "ç†µ",
  "target_node": "çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹"
}
```

ç”Ÿæˆçš„é—®é¢˜ï¼š
```
"è¯·è¯¦ç»†è¯´æ˜ 'ç†µ' å’Œ 'çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹' ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æä¾›æ¨ç†è¿‡ç¨‹ï¼Œ100å­—å·¦å³ã€‚"
```

#### å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

```javascript
// çŸ¥è¯†é—®ç­”
async function askQuestion(concept, sourceNode, targetNode, customQuestion = null) {
  try {
    const response = await fetch('http://localhost:8002/api/qa', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        concept,
        source_node: sourceNode,
        target_node: targetNode,
        question: customQuestion, // å¯é€‰
      }),
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const result = await response.json();
    
    // æ˜¾ç¤ºç­”æ¡ˆ
    displayAnswer(result.answer);
    
    return result;
  } catch (error) {
    console.error('Failed to get answer:', error);
    throw error;
  }
}

// ä½¿ç”¨ç¤ºä¾‹ 1ï¼šé»˜è®¤é—®é¢˜
askQuestion('ç†µ', 'ç†µ', 'çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹').then(result => {
  console.log('ç­”æ¡ˆ:', result.answer);
});

// ä½¿ç”¨ç¤ºä¾‹ 2ï¼šè‡ªå®šä¹‰é—®é¢˜
askQuestion(
  'ç†µ', 
  'ç†µ', 
  'ä¿¡æ¯ç†µ',
  'å®ƒä»¬çš„æ•°å­¦å…¬å¼æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿ'
).then(result => {
  console.log('ç­”æ¡ˆ:', result.answer);
});
```

#### é”™è¯¯å“åº”

**500 Internal Server Error** - æŸ¥è¯¢å¤±è´¥

```json
{
  "detail": "Query failed: çŸ¥è¯†å›¾è°±æœªæ„å»ºï¼šç†µ"
}
```

---

## ğŸ”§ è¾…åŠ©æ¥å£

### 3. è·å–æ¦‚å¿µåˆ—è¡¨

è·å–æ‰€æœ‰å·²æ„å»ºçš„çŸ¥è¯†å›¾è°±æ¦‚å¿µã€‚

#### è¯·æ±‚

```http
GET /api/concepts
```

#### å“åº”ç¤ºä¾‹

```json
{
  "concepts": ["ç†µ", "é‡å­çº ç¼ ", "æ·±åº¦å­¦ä¹ ", "åŒºå—é“¾"]
}
```

#### å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

```javascript
// è·å–æ¦‚å¿µåˆ—è¡¨
async function fetchConcepts() {
  const response = await fetch('http://localhost:8002/api/concepts');
  const data = await response.json();
  return data.concepts;
}

// æ¸²æŸ“æ¦‚å¿µé€‰æ‹©å™¨
fetchConcepts().then(concepts => {
  renderConceptSelector(concepts);
});
```

---

### 4. å¥åº·æ£€æŸ¥

æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

#### è¯·æ±‚

```http
GET /health
```

#### å“åº”ç¤ºä¾‹

```json
{
  "status": "ok",
  "service": "knowledge-engine"
}
```

---

### 5. æ‘„å–æ–‡æ¡£ï¼ˆSearch Agent ä½¿ç”¨ï¼‰

**ã€å‰ç«¯é€šå¸¸ä¸ç›´æ¥è°ƒç”¨ã€‘** ç”± Search Agent è°ƒç”¨ï¼Œç”¨äºæ„å»ºçŸ¥è¯†å›¾è°±ã€‚

#### è¯·æ±‚

```http
POST /api/ingest
```

#### è¯·æ±‚ä½“

```json
{
  "concept": "ç†µ",
  "chunks": [
    {
      "id": "chunk-abc123",
      "content": "ç†µæ˜¯ç³»ç»Ÿæ— åºç¨‹åº¦çš„åº¦é‡...",
      "discipline": "ç‰©ç†å­¦",
      "source": {
        "url": "https://example.com",
        "title": "çƒ­åŠ›å­¦åŸºç¡€"
      },
      "relevance_score": 0.95,
      "academic_value": 0.88
    }
  ]
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "status": "accepted",
  "task_id": "task-a3b4c5d6",
  "message": "Processing 10 documents for concept 'ç†µ'"
}
```

---

### 6. æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

æŸ¥è¯¢æ–‡æ¡£æ‘„å–ä»»åŠ¡çš„å¤„ç†çŠ¶æ€ã€‚

#### è¯·æ±‚

```http
GET /api/task/{task_id}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "task_id": "task-a3b4c5d6",
  "status": "completed"
}
```

**status çš„å€¼**ï¼š
- `processing` - å¤„ç†ä¸­
- `completed` - å·²å®Œæˆ
- `failed` - å¤±è´¥
- `not_found` - ä»»åŠ¡ä¸å­˜åœ¨
